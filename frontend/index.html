<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token Generation Portal / рдЯреЛрдХрди рдЬрдирд░реЗрд╢рди рдкреЛрд░реНрдЯрд▓</title>

  <link rel="stylesheet" href="css/style.css">


</head>

<body>

<!-- ЁЯЗоЁЯЗ│ GOVERNMENT HEADER -->
<header class="gov-header">
  <div class="gov-left">
    <img src="assets/india-emblem.png" alt="Government of India Logo">
  </div>

  <div class="gov-center">
    <h1>Government of India / рднрд╛рд░рдд рд╕рд░рдХрд╛рд░</h1>
    <p>Appointment & Walk-in Token Management System</p>
  </div>

  <div class="gov-right">
    <img src="assets/Aadhaar_Small.png" alt="Department Logo">
  </div>
</header>

<h2 style="text-align:center;">
  Token Generation Portal / рдЯреЛрдХрди рдЬрдирд░реЗрд╢рди рдкреЛрд░реНрдЯрд▓
</h2>
<h3 style="text-align:center; margin-top:20px; color:#b30000; font-size: 20px;">
  Call on 1947 to register your complaint, and keep the complaint number (QRC) with you for future reference. 
  <br>
  рдЕрдкрдиреА рд╢рд┐рдХрд╛рдпрдд рджрд░реНрдЬ рдХрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП 1947 рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВ рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╕рдВрджрд░реНрдн рдХреЗ рд▓рд┐рдП рд╢рд┐рдХрд╛рдпрдд рд╕рдВрдЦреНрдпрд╛ (рдХреНрдпреВрдЖрд░рд╕реА) рдЕрдкрдиреЗ рдкрд╛рд╕ рд░рдЦреЗрдВред
</h3>

<!-- ЁЯУв STATUS MESSAGE -->
<p id="locationStatus" style="text-align:center; font-weight:600;">
  тП│ Checking booking availability...
</p>

<!-- ЁЯФШ USER ACTION BUTTONS -->
<div style="text-align:center; margin-top:30px;">
  <button id="appointmentBtn" style="display:none;">
    ЁЯУЕ Book Appointment / рдЕрдкреЙрдЗрдВрдЯрдореЗрдВрдЯ рдмреБрдХ рдХрд░реЗрдВ
  </button>

  <button id="walkinBtn" style="display:none;">
    ЁЯЪ╢ Generate Walk-in Token / рд╡реЙрдХ-рдЗрди рдЯреЛрдХрди рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ
  </button>
</div>

<!-- ЁЯФР ADMIN LOGIN (ALWAYS ENABLED) -->
<div style="text-align:center; margin-top:25px;">
  <button id="adminLoginBtn"
          onclick="window.location.href='admin-login.html'">
    ЁЯФР Admin Login / рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд▓реЙрдЧрд┐рди
  </button>
  <button id="guardLoginBtn"
          onclick="window.location.href='guard-login.html'">
    ЁЯЫбя╕П Guard Login / рдЧрд╛рд░реНрдб рд▓реЙрдЧрд┐рди
  </button>
</div>

<!-- ============================= -->
<!-- ЁЯза MAIN LOGIC -->
<!-- ============================= -->
<script>
  const statusEl = document.getElementById("locationStatus");
  const appointmentBtn = document.getElementById("appointmentBtn");
  const walkinBtn = document.getElementById("walkinBtn");
  const guardLoginBtn = document.getElementById("guardLoginBtn");
  appointmentBtn.style.display = "inline-block";

  // ЁЯЪл DISABLE USER BUTTONS (ADMIN NOT TOUCHED)
//  function disableUserButtons() {
//    [appointmentBtn, walkinBtn].forEach(btn => {
//      btn.disabled = true;
//      btn.style.opacity = "0.6";
//      btn.style.cursor = "not-allowed";
//    });
//  }

  // ЁЯУН LOCATION CHECK (ONLY IF TIME IS VALID)
  async function checkLocation() {
    if (!navigator.geolocation) {
      statusEl.innerText = "тЭМ Geolocation not supported";
      return;
    }

    statusEl.innerText = "ЁЯУН Checking your location...";

    navigator.geolocation.getCurrentPosition(
      async (pos) => {
        try {
          const res = await fetch("/api/location-check", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              latitude: pos.coords.latitude,
              longitude: pos.coords.longitude
            })
          });

          const data = await res.json();

          localStorage.setItem("distance_meters", data.distance_meters);

          statusEl.innerText =
            `ЁЯУН Distance from office: ${data.distance_meters} meters`;

          if (data.distance_meters <= 100) {
            walkinBtn.style.display = "inline-block";
          } else {
//            appointmentBtn.style.display = "inline-block";
              walkinBtn.style.display = "none";
          }

        } catch {
          statusEl.innerText = "тЭМ Failed to verify location";
        }
      },
      () => {
        statusEl.innerText = "тЭМ Location permission denied";
      }
    );
  }

  // ЁЯФА BUTTON NAVIGATION
  appointmentBtn.onclick = () => {
    window.location.href = "appointment.html";
  };

  walkinBtn.onclick = () => {
    window.location.href = "walkin.html";
  };

  // ЁЯЪж ENTRY POINT
  window.addEventListener("load", () => {
//    if (!isWithinBookingTimeIST()) {
//      statusEl.innerText =
//        "Booking allowed only between 6:00 AM and 4:00 PM/ рдмреБрдХрд┐рдВрдЧ рдХреЗрд╡рд▓ рд╕реБрдмрд╣ 6:00 рдмрдЬреЗ рд╕реЗ рд╢рд╛рдо 4:00 рдмрдЬреЗ рдХреЗ рдмреАрдЪ рд╣реА рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред";
//
//      disableUserButtons();
//      return; // тЫФ STOP EVERYTHING (NO LOCATION CHECK)
//    }

    // тЬЕ Time valid тЖТ now check location
    checkLocation();
  });
</script>

</body>
</html>
